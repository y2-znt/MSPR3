<h2 mat-dialog-title id="dialog-title">Edit a COVID-19 Case</h2>

<form
    [formGroup]="caseForm"
    (ngSubmit)="onSubmit()"
    role="form"
    aria-labelledby="dialog-title"
    >
    <div mat-dialog-content>
        <!-- Country -->
        <mat-form-field appearance="outline" class="full-width">
        <mat-label>Country</mat-label>
        <mat-select
            formControlName="country"
            aria-label="Country"
            [attr.aria-describedby]="caseForm.get('country')?.hasError('required') ? 'country-error' : null"
            required
        >
            <mat-option
            *ngFor="let country of data.countries"
            [value]="country.name"
            >
            {{ country.name }}
            </mat-option>
        </mat-select>
        <mat-error id="country-error" *ngIf="caseForm.get('country')?.hasError('required')">
            Country is required
        </mat-error>
        </mat-form-field>

        <!-- Date -->
        <mat-form-field appearance="outline" class="full-width">
        <mat-label>Date</mat-label>
        <input
            matInput
            [matDatepicker]="datePicker"
            formControlName="date"
            aria-label="Date"
            [attr.aria-describedby]="caseForm.get('date')?.hasError('required') ? 'date-error' : null"
            required
        />
        <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
        <mat-datepicker #datePicker></mat-datepicker>
        <mat-error id="date-error" *ngIf="caseForm.get('date')?.hasError('required')">
            Date is required
        </mat-error>
        </mat-form-field>

        <!-- Confirmed Cases -->
        <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirmed Cases</mat-label>
        <input
            matInput
            type="number"
            formControlName="confirmedCases"
            aria-label="Confirmed Cases"
            [attr.aria-describedby]="
            caseForm.get('confirmedCases')?.hasError('required') ? 'confirmed-error' :
            caseForm.get('confirmedCases')?.hasError('min') ? 'confirmed-min-error' : null
            "
            min="0"
            required
        />
        <mat-error id="confirmed-error" *ngIf="caseForm.get('confirmedCases')?.hasError('required')">
            Confirmed cases are required
        </mat-error>
        <mat-error id="confirmed-min-error" *ngIf="caseForm.get('confirmedCases')?.hasError('min')">
            Value must be 0 or higher
        </mat-error>
        </mat-form-field>

        <!-- Deaths -->
        <mat-form-field appearance="outline" class="full-width">
        <mat-label>Deaths</mat-label>
        <input
            matInput
            type="number"
            formControlName="deaths"
            aria-label="Deaths"
            [attr.aria-describedby]="
            caseForm.get('deaths')?.hasError('required') ? 'deaths-error' :
            caseForm.get('deaths')?.hasError('min') ? 'deaths-min-error' : null
            "
            min="0"
            required
        />
        <mat-error id="deaths-error" *ngIf="caseForm.get('deaths')?.hasError('required')">
            Number of deaths is required
        </mat-error>
        <mat-error id="deaths-min-error" *ngIf="caseForm.get('deaths')?.hasError('min')">
            Value must be 0 or higher
        </mat-error>
        </mat-form-field>

        <!-- Recoveries -->
        <mat-form-field appearance="outline" class="full-width">
        <mat-label>Recoveries</mat-label>
        <input
            matInput
            type="number"
            formControlName="recovered"
            aria-label="Recoveries"
            [attr.aria-describedby]="
            caseForm.get('recovered')?.hasError('required') ? 'recovered-error' :
            caseForm.get('recovered')?.hasError('min') ? 'recovered-min-error' : null
            "
            min="0"
            required
        />
        <mat-error id="recovered-error" *ngIf="caseForm.get('recovered')?.hasError('required')">
            Number of recoveries is required
        </mat-error>
        <mat-error id="recovered-min-error" *ngIf="caseForm.get('recovered')?.hasError('min')">
            Value must be 0 or higher
        </mat-error>
        </mat-form-field>
    </div>

    <div mat-dialog-actions align="end">
        <button
        mat-button
        type="button"
        (click)="onCancel()"
        [disabled]="isSubmitting"
        aria-label="Cancel editing"
        >
        Cancel
        </button>
        <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="caseForm.invalid || isSubmitting"
        aria-label="Save changes"
        >
        <mat-spinner diameter="20" *ngIf="isSubmitting" aria-label="Loading"></mat-spinner>
        <span *ngIf="!isSubmitting">Save</span>
        </button>
    </div>
</form>
